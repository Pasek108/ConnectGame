"use strict";class Editor extends View{constructor(e){super(`.edit-screen .${e}`),this.container_class=e,this.empty_type="pipes"===e?"c":"n",this.mode_class="pipes"===e?PipesUtils:SquaresUtils,this.grid=this.container.querySelector(".grid"),this.grid_size=3,this.size_input=this.container.querySelector(".size input"),this.size_input.addEventListener("input",this.changeGridSize.bind(this)),this.tile_size=this.container.querySelector(".tile-size"),this.tile_size.addEventListener("input",this.changeTileSize.bind(this)),this.tile_size.value=6,this.generate=this.container.querySelector(".generate"),this.generate.addEventListener("click",this.generateLevel.bind(this)),this.previews=this.container.querySelectorAll(".preview");for(let e=0;e<this.previews.length;e++){switch(e){case 0:this.previews[e].dataset.data="0;0;0;0;"+this.empty_type;break;case 1:this.previews[e].dataset.data="1;0;0;0;"+this.empty_type;break;case 2:this.previews[e].dataset.data="1;1;0;0;"+this.empty_type;break;case 3:this.previews[e].dataset.data="1;0;1;0;"+this.empty_type;break;case 4:this.previews[e].dataset.data="1;1;1;0;"+this.empty_type;break;case 5:this.previews[e].dataset.data="1;1;1;1;"+this.empty_type}this.previews[e].addEventListener("dragstart",(()=>this.dragged=this.previews[e]))}}load(){this.dragged=null,this.level=[],this.show(),this.createGrid()}changeGridSize(){this.grid_size=+this.size_input.value,this.createGrid()}generateLevel(){this.level=Pipes.generateNewLevel(this.grid_size,this.grid_size)}changeTileSize(){for(let e=0;e<this.previews.length;e++)this.previews[e].className=`preview ${this.container_class} size-${this.tile_size.value}`,this.previews[e].style.width=`${this.tile_size.value}rem`,this.previews[e].style.height=`${this.tile_size.value}rem`;this.grid.className=`grid ${this.container_class} size-${this.tile_size.value}`,this.grid.style.width=this.grid_size*this.tile_size.value+.1*(this.grid_size-1)+"rem",this.grid.style.height=this.grid_size*this.tile_size.value+.1*(this.grid_size-1)+"rem",this.grid.style.gridTemplateColumns=`repeat(${this.grid_size}, ${this.tile_size.value}rem)`,this.grid.style.gridTemplateRows=`repeat(${this.grid_size}, ${this.tile_size.value}rem)`}createGrid(){this.grid.innerHTML="",this.changeTileSize(),this.level=this.mode_class.createEmptyLevelArray(this.grid_size,this.grid_size),this.tiles=[];for(let e=0;e<this.grid_size;e++){this.tiles.push([]);for(let t=0;t<this.grid_size;t++){const i=GlobalUtils.createNewDOM("div","tile");i.draggable="true",i.dataset.data="0;0;0;0;"+this.empty_type,i.addEventListener("click",(i=>this.rotateTile(i,e,t))),i.addEventListener("dragstart",(()=>this.dragged=i)),i.addEventListener("dragover",(e=>e.preventDefault())),i.addEventListener("drop",(i=>this.dropOnTile(i,e,t))),this.grid.appendChild(i),this.tiles[e].push(i)}}}dropOnTile(e,t,i){e.preventDefault();const s=e.currentTarget;if(s===this.dragged)return;const r=this.dragged.dataset.data.split(";");if(this.level[t][i]=[+r[0],+r[1],+r[2],+r[3],r[4]],s.dataset.data=this.dragged.dataset.data,s.innerHTML=this.dragged.innerHTML,this.dragged.classList.contains("tile")){this.dragged.dataset.data="0;0;0;0;"+this.empty_type,this.dragged.innerHTML="";for(let e=0;e<this.tiles.length;e++)for(let t=0;t<this.tiles[e].length;t++)if(this.tiles[e][t]===this.dragged){this.level[e][t]=[0,0,0,0,this.empty_type],e=this.tiles.length;break}}}rotateTile(e,t,i){const s=e.currentTarget,r=s.dataset.data.split(";");if(0==r[0]&&0==r[1]&&0==r[2]&&0==r[3])return;const a=r[0];r[0]=r[3],r[3]=r[2],r[2]=r[1],r[1]=a,s.dataset.data=r.join(";"),s.innerHTML="",this.level[t][i]=[+r[0],+r[1],+r[2],+r[3],r[4]];const h=this.mode_class.createBlock([+r[0],+r[1],+r[2],+r[3],r[4]],!0,!0);s.appendChild(h)}}